# Ansible (Nginx)

## Описание репозитория

Данный плейбук предназначен для первоначальной настройки хостов в виду установки nginx и запуск сервера на https протоколе (с получением сертификата на домен)

## Cтруктура скачиваемого каталога

|── ansible.cfg
├── my-playbooks
│   ├── group_vars
│   │   └── workserver.yaml
│   ├── host_vars
│   │   └── nord1.yaml
│   ├── inventory.yaml
│   └── playbook.yaml
└── templates
    ├── conf
    │   └── nginx.j2
    └── site
        ├── file1.j2
        └── file2.j2```

## Первичная настройка

 Сразу после скачивания репозитория необходимо разобраться с файлами, в которых содержатся переменные

### I. inventory.yaml (инвентарный файл)

```all:
    children:
1)   workserver:
        hosts:
2)      nord1:
3)          ansible_host:
4)          ansible_user:
            var:
5)            ansible_ssh_private_key_file:
            vars_file:```

1) Группа - меняете по усмотрению. Файл с переменными для групп расположен по пути `/ansible/my-playbooks/group_vars`. При переименовании группы переименовываете файл расположенный по этому пути. (подробнее п.5).

2) Наименование хоста - меняете по усмотрению. Файл с переменными для хоста расположен по пути `/ansible/my-playbooks/hosts_vars`. При переименовании хоста переименовываете файл расположенный по этому пути (подробнее п. II).

3)  ip адрес хоста - меняете на ip адрес системы (или ВМ), на которую/ые будут отправлены задачи плейбука.

4) наименование юзера - меняете на имя юзера, который зарегистрирован на хосте системы (или ВМ).

5) Переменная по расположению ssh-ключа (прим. файл в гитхабе зашифрован) -
5.1. Если у вас к хостам подключение по ssh, то переходите по пути расположения файла `/ansible/my-playbooks/group_vars`, в расположенном в директории файле `workserver.yaml` (или если вы переименовывали группы в `inventory.yaml` то переименовываете и файл (см. п. 1) напротив переменной `ansible_ssh_private_key_file:` вписываете путь до расположения открытого ssh-ключа от хоста, расположенного на вашем сервере. 
5.2. Если у вас подключение по паролю, то вместо переменной `ansible_ssh_private_key_file:` в файлах инвентаря и групповых переменных нужно подставить переменную `ansible_password:`, а затем либо в инвентаре или файле для переменных вписать пароль от хоста.
5.3. Если у вас нет защиты на подключение к хосту - то удалите 3 последние строчки в файле `inventory.yaml` (со строчки "var:")


### II. nord1.yaml (файл с переменными)

Файл с переменными, расположенный по пути /ansible/my-playbook/host_vars, носит наименование хоста, указанного в инвентарном файле. Если переименовываете хост, этот файл так же переименовываете

```path_to_cofgfile: /ansible/templates/conf
path_to_site: /ansible/templates/site
domain_name: 
domain_url: 
letsencrypt_email:```

В файле расположены следующие переменные, которые вы корректируете по своему усмотрению):

1) "path_to_cofgfile:" - путь до расположения конфигурации nginx (файл `nginx.j2`), расположен в `ansible/templates/conf`

2) "path_to_site: " - путь до расположения файлов настроек сайта (файлы `file1/2.j2`), расположены в `/ansible/templates/site`
 
3) "domain_name:" - наименование вашего домена 

4) "domain_url:" - наименование вашего сайта

5) "letsencrypt_email:" - ваша почта (необходимо при получении сертификата)


## Запуск

Когда все переменные изменены в соответствии с вашими возможностями и предпочтениями на вашем сервере, можно запускать плейбук в директории где будет раположен файл `playbook.yaml`
```ansible-playbook -i inventory.yaml (или прописать его в файле ansible.cfg) playbook.yaml "имя хоста"```
